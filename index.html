<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophia v11.1 - Assistente Pessoal</title>
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#BB86FC">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        :root { --bg-primary: #121212; --bg-secondary: #1E1E1E; --bg-tertiary: #2A2A2A; --text-primary: #EAEAEA; --text-secondary: #A0A0A0; --accent-primary: #BB86FC; --accent-secondary: #03DAC6; --bot-msg-bg: #2A2A2A; --user-msg-bg: linear-gradient(135deg, #712B75, #A020F0); --font-main: 'Inter', sans-serif; }
        body.kai-theme { --bg-primary: #0d0d0d; --bg-secondary: #1a1a1a; --text-primary: #00ff41; --text-secondary: #8c8c8c; --accent-primary: #00aaff; --user-msg-bg: linear-gradient(135deg, #0055ff, #00aaff); --font-main: 'Fira Code', monospace; }
        
        html, body { height: 100%; margin: 0; overflow: hidden; font-family: var(--font-main); background: var(--bg-primary); color: var(--text-primary); }
        
        #intro-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-primary); z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center; padding: 20px; transition: opacity 0.5s ease-out; }
        .intro-content { max-width: 500px; }
        .intro-content h1 { font-size: 2.5em; margin-bottom: 10px; } .intro-content h1 span { color: var(--accent-primary); }
        .intro-content p { color: var(--text-secondary); margin-bottom: 20px; }
        .terms-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; font-size: 0.9em; }
        #terms-checkbox { width: 18px; height: 18px; }
        #start-button { background: var(--accent-primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 1em; font-weight: 500; cursor: pointer; opacity: 0.5; pointer-events: none; transition: opacity 0.3s; }
        #start-button:not(:disabled) { opacity: 1; pointer-events: auto; }

        .app-container { display: flex; height: 100%; width: 100%; opacity: 0; transition: opacity 0.5s; }
        #sidebar { width: 300px; background: var(--bg-secondary); padding: 20px; display: flex; flex-direction: column; border-right: 1px solid var(--bg-tertiary); }
        .sidebar-nav { flex-grow: 1; overflow-y: auto; }
        .sidebar-nav h3 { color: var(--text-secondary); font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; margin: 20px 0 10px 0; }
        .sidebar-nav button { background: var(--bg-tertiary); border: none; width: 100%; color: var(--text-primary); text-align: left; padding: 12px 15px; font-size: 1em; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: all 0.2s; font-family: var(--font-main); margin-bottom: 8px; }
        .sidebar-nav button:hover { background: var(--accent-primary); color: #121212; }
        
        .main-chat { flex: 1; display: flex; flex-direction: column; }
        #header { padding: 10px 20px; background: var(--bg-secondary); display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--bg-tertiary); }
        #menu-toggle { background: none; border: none; color: var(--text-primary); font-size: 1.8em; cursor: pointer; display: none; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        .message { display: flex; align-items: flex-end; gap: 10px; max-width: 80%; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 500; flex-shrink: 0; background: var(--bg-tertiary); }
        .bot .avatar.typing-avatar { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { background-color: var(--bg-tertiary); } 50% { background-color: var(--accent-secondary); } }
        .msg-content { padding: 15px 20px; border-radius: 20px; }
        .bot .msg-content { background: var(--bot-msg-bg); border-bottom-left-radius: 5px; }
        .user { align-self: flex-end; flex-direction: row-reverse; } .user .avatar { background: var(--accent-primary); } .user .msg-content { background: var(--user-msg-bg); color: white; border-bottom-right-radius: 5px; }
        
        #input-area { display: flex; gap: 10px; padding: 10px 20px; border-top: 1px solid var(--bg-tertiary); }
        #input { flex: 1; padding: 15px; border: none; outline: none; background: var(--bg-secondary); color: var(--text-primary); border-radius: 15px; font-size: 1em; font-family: var(--font-main); }
        #send { background: var(--accent-primary); border: none; padding: 15px; cursor: pointer; color: white; border-radius: 15px; }
        
        #kai-trigger { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #00aaff; border-radius: 50%; cursor: pointer; z-index: 999; }
        #kai-chat-window { position: fixed; bottom: 90px; right: 20px; width: 350px; height: 450px; background: #0d0d0d; border: 1px solid #00aaff; border-radius: 15px; display: none; flex-direction: column; }
        
        @media (max-width: 768px) {
            #sidebar { position: fixed; height: 100%; z-index: 1000; margin-left: -100%; width: 80%; }
            #sidebar.open { margin-left: 0; }
            #menu-toggle { display: block; }
        }
    </style>
</head>
<body>
    <div id="intro-overlay">
        <div class="intro-content">
            <h1>‚ú¶<span>Ôº≥œÉœÅ—í…™Œ±</span>‚ú¶</h1>
            <p>Sua assistente pessoal com mem√≥ria e aprendizado. Suas conversas e dados s√£o salvos localmente no seu navegador para total privacidade.</p>
            <div class="terms-container">
                <input type="checkbox" id="terms-checkbox">
                <label for="terms-checkbox">Eu li e aceito os <a href="https://naotodev1.github.io/terms-e-policy/" target="_blank">Termos de Uso e Pol√≠tica de Privacidade</a></label>
            </div>
            <button id="start-button" disabled>Come√ßar</button>
        </div>
    </div>

    <div class="app-container">
        <aside id="sidebar"></aside>
        <main id="main-chat">
            <div id="header">
                <button id="menu-toggle">&#9776;</button>
                <div class="header-title">
                    <h2 id="header-name">Sophia</h2>
                    <p id="header-subtitle">v11.1</p>
                </div>
            </div>
            <div id="messages"></div>
            <div id="input-area">
                <input type="text" id="input" placeholder="Digite sua mensagem..." />
                <button id="send">Enviar</button>
            </div>
        </main>
    </div>

    <div id="kai-trigger" style="display:none;">üöÄ</div>
    <div id="kai-chat-window" style="display:none;"> <!-- KAI Chat UI a ser implementada --> </div>

    <script>
        // --- 1. CONFIGURA√á√ÉO E ELEMENTOS DO DOM ---
        const introOverlay = document.getElementById('intro-overlay');
        const termsCheckbox = document.getElementById('terms-checkbox');
        const startButton = document.getElementById('start-button');
        const appContainer = document.getElementById('app-container');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const messagesContainer = document.getElementById("messages");
        const inputField = document.getElementById("input");
        const sendButton = document.getElementById("send");
        const headerName = document.getElementById('header-name');
        const headerSubtitle = document.getElementById('header-subtitle');

        // ‚ùó‚ùó‚ùó CHAVE DA API GNEWS AQUI ‚ùó‚ùó‚ùó
        const NEWS_API_KEY = 'SUA_CHAVE_DE_API_AQUI';

        // --- 2. MEM√ìRIA E ESTADO ---
        let appState = {};
        const defaultMemory = {
            botProfile: { name: 'Sophia', mode: 'sophia' },
            userProfile: { name: null, acceptedTerms: false },
            knowledge: { 'sophia': 'uma assistente virtual.' }
        };
        function loadMemory() {
            const saved = localStorage.getItem('SOPHIA_MEMORY_V11');
            appState.memory = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultMemory));
        }
        function saveMemory() {
            localStorage.setItem('SOPHIA_MEMORY_V11', JSON.stringify(appState.memory));
        }
        
        // --- 3. C√âREBRO (L√ìGICA PRINCIPAL) ---
        const brain = {
            getResponse: async function(userText) {
                // ... (Cole aqui o c√©rebro completo da v10, com as personalidades Sophia e KAI e todos os handlers)
                return { response: `Resposta para: ${userText}` }; // Placeholder
            }
        };

        // --- 4. M√ìDULO DE UI ---
        const UI = {
            init: function() {
                termsCheckbox.addEventListener('change', () => { startButton.disabled = !termsCheckbox.checked; });
                startButton.addEventListener('click', UI.startApp);
                menuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
                sendButton.addEventListener('click', () => handleSend());
                inputField.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
            },
            startApp: function() {
                appState.memory.userProfile.acceptedTerms = true;
                if (!appState.memory.userProfile.name) {
                    const name = prompt("Bem-vindo(a)! Como posso te chamar?");
                    if (name) appState.memory.userProfile.name = name;
                }
                saveMemory();
                introOverlay.style.opacity = '0';
                setTimeout(() => {
                    introOverlay.style.display = 'none';
                    appContainer.style.opacity = '1';
                    UI.renderSidebar();
                    UI.updateHeader();
                    UI.addMessage(`Ol√°, ${appState.memory.userProfile.name || 'usu√°rio'}! Explore o menu para ver o que posso fazer.`, 'bot');
                }, 500);
            },
            renderSidebar: function() {
                sidebar.innerHTML = `
                    <div class="sidebar-header"><h2 id="sidebar-name">‚ú¶<span>SOPHIA</span>‚ú¶</h2></div>
                    <nav class="sidebar-nav">
                        <h3>Funcionalidades</h3>
                        <button data-command="not√≠cias">üì∞ Not√≠cias</button>
                        <button data-command="o que significa...">üìñ Dicion√°rio</button>
                        <h3>Wiki Pessoal</h3>
                        <div id="wiki-list" style="font-size: 0.8em; color: var(--text-secondary); padding: 0 15px;">Sua wiki aparecer√° aqui. Ensine algo √† Sophia para come√ßar.</div>
                        <button data-command="ver wiki">Ver/Atualizar Wiki</button>
                        <h3>Conta</h3>
                        <button onclick="UI.exportData()">üì• Exportar Dados</button>
                        <button onclick="UI.deleteAccount()">‚ùå Excluir Conta</button>
                        <hr style="border-color: var(--bg-tertiary); margin: 15px 0;">
                        <button id="kai-mode-btn" data-command="kai">üöÄ Ativar Modo KAI</button>
                    </nav>
                `;
                sidebar.querySelectorAll('button[data-command]').forEach(btn => {
                    btn.addEventListener('click', () => handleSend(btn.dataset.command));
                });
            },
            updateHeader: function() {
                headerName.innerText = appState.memory.botProfile.name;
                headerSubtitle.innerText = `Modo ${appState.memory.botProfile.mode}`;
            },
            addMessage: function(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                const avatarChar = sender === 'user' ? (appState.memory.userProfile.name ? appState.memory.userProfile.name.charAt(0).toUpperCase() : 'U') : (appState.memory.botProfile.mode === 'kai' ? 'K' : appState.memory.botProfile.name.charAt(0).toUpperCase());
                messageDiv.innerHTML = `<div class="avatar">${avatarChar}</div><div class="msg-content">${text.replace(/\n/g, '<br>')}</div>`;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },
            exportData: function() {
                const dataStr = JSON.stringify(appState.memory, null, 2);
                const blob = new Blob([dataStr], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'sophia_memory.json'; a.click();
                URL.revokeObjectURL(url);
            },
            deleteAccount: function() {
                if (confirm("Voc√™ tem certeza que quer excluir todos os seus dados? Esta a√ß√£o n√£o pode ser desfeita.")) {
                    localStorage.removeItem('SOPHIA_MEMORY_V11');
                    window.location.reload();
                }
            }
        };
        
        // --- 5. INICIALIZA√á√ÉO ---
        window.onload = () => {
            loadMemory();
            UI.init(); // Anexa os eventos primeiro
            if (appState.memory.userProfile.acceptedTerms) {
                UI.startApp();
            }
        };

        // --- FUN√á√ÉO DE ENVIO GLOBAL ---
        async function handleSend(prefilledText) {
            const userText = typeof prefilledText === 'string' ? prefilledText : inputField.value.trim();
            if (!userText) return;

            UI.addMessage(userText, 'user');
            if (typeof prefilledText !== 'string') inputField.value = '';
            
            // Placeholder para a l√≥gica do c√©rebro
            const botPayload = await brain.getResponse(userText);
            UI.addMessage(botPayload.response, 'bot');
        }

        // --- REGISTRO DO SERVICE WORKER (ESSENCIAL PARA PWA) ---
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('service-worker.js')
              .then(registration => { console.log('Service Worker registrado com sucesso:', registration); })
              .catch(error => { console.log('Falha ao registrar o Service Worker:', error); });
          });
        }
    </script>
</body>
</html>
